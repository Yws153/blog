

# 用 creat-react-app 重构项目架构过程记录

​	第一步，先用Facebook 贡献的 Javascript 包管理器yarn，替换原来的npm包管理器。

​	yarn的介绍及使用方法略；

​	第二部，找到 package.json 文件，看 scripts 的配置，找到对应的 start.js 文件，如下：

 ```
'use strict';

// Do this as the first thing so that any code reading it knows the right env.
// 配置当前的环境变量
process.env.BABEL_ENV = 'development';
process.env.NODE_ENV = 'development';

// Makes the script crash on unhandled rejections instead of silently
// ignoring them. In the future, promise rejections that are not handled will
// terminate the Node.js process with a non-zero exit code.
process.on('unhandledRejection', err => {
  throw err;
});

// Ensure environment variables are read.
require('../config/env');


const fs = require('fs');
const chalk = require('react-dev-utils/chalk');
const webpack = require('webpack');
const WebpackDevServer = require('webpack-dev-server');
const clearConsole = require('react-dev-utils/clearConsole');
const checkRequiredFiles = require('react-dev-utils/checkRequiredFiles');
const {
  choosePort,
  createCompiler,
  prepareProxy,
  prepareUrls,
} = require('react-dev-utils/WebpackDevServerUtils');
const openBrowser = require('react-dev-utils/openBrowser');
const paths = require('../config/paths');
const configFactory = require('../config/webpack.config');
const createDevServerConfig = require('../config/webpackDevServer.config');

const useYarn = fs.existsSync(paths.yarnLockFile);
const isInteractive = process.stdout.isTTY;

// Warn and crash if required files are missing
if (!checkRequiredFiles([paths.appHtml, paths.appIndexJs])) {
  process.exit(1);
}

// Tools like Cloud9 rely on this.
const DEFAULT_PORT = parseInt(process.env.PORT, 10) || 3000;
const HOST = process.env.HOST || '0.0.0.0';

if (process.env.HOST) {
  console.log(
    chalk.cyan(
      `Attempting to bind to HOST environment variable: ${chalk.yellow(
        chalk.bold(process.env.HOST)
      )}`
    )
  );
  console.log(
    `If this was unintentional, check that you haven't mistakenly set it in your shell.`
  );
  console.log(
    `Learn more here: ${chalk.yellow('https://bit.ly/CRA-advanced-config')}`
  );
  console.log();
}

// We require that you explicitly set browsers and do not fall back to
// browserslist defaults.
const { checkBrowsers } = require('react-dev-utils/browsersHelper');
checkBrowsers(paths.appPath, isInteractive)
  .then(() => {
    // We attempt to use the default port but if it is busy, we offer the user to
    // run on a different port. `choosePort()` Promise resolves to the next free port.
    return choosePort(HOST, DEFAULT_PORT);
  })
  .then(port => {
    if (port == null) {
      // We have not found a port.
      return;
    }

    const config = configFactory('development');
    const protocol = process.env.HTTPS === 'true' ? 'https' : 'http';
    const appName = require(paths.appPackageJson).name;
    const useTypeScript = fs.existsSync(paths.appTsConfig);
    const tscCompileOnError = process.env.TSC_COMPILE_ON_ERROR === 'true';
    const urls = prepareUrls(
      protocol,
      HOST,
      port,
      paths.publicUrlOrPath.slice(0, -1)
    );
    const devSocket = {
      warnings: warnings =>
        devServer.sockWrite(devServer.sockets, 'warnings', warnings),
      errors: errors =>
        devServer.sockWrite(devServer.sockets, 'errors', errors),
    };
    // Create a webpack compiler that is configured with custom messages.
    const compiler = createCompiler({
      appName,
      config,
      devSocket,
      urls,
      useYarn,
      useTypeScript,
      tscCompileOnError,
      webpack,
    });
    // Load proxy config
    const proxySetting = require(paths.appPackageJson).proxy;
    const proxyConfig = prepareProxy(
      proxySetting,
      paths.appPublic,
      paths.publicUrlOrPath
    );
    // Serve webpack assets generated by the compiler over a web server.
    const serverConfig = createDevServerConfig(
      proxyConfig,
      urls.lanUrlForConfig
    );
    const devServer = new WebpackDevServer(compiler, serverConfig);
    // Launch WebpackDevServer.
    devServer.listen(port, HOST, err => {
      if (err) {
        return console.log(err);
      }
      if (isInteractive) {
        clearConsole();
      }

      // We used to support resolving modules according to `NODE_PATH`.
      // This now has been deprecated in favor of jsconfig/tsconfig.json
      // This lets you use absolute paths in imports inside large monorepos:
      if (process.env.NODE_PATH) {
        console.log(
          chalk.yellow(
            'Setting NODE_PATH to resolve modules absolutely has been deprecated in favor of setting baseUrl in jsconfig.json (or tsconfig.json if you are using TypeScript) and will be removed in a future major release of create-react-app.'
          )
        );
        console.log();
      }

      console.log(chalk.cyan('Starting the development server...\n'));
      openBrowser(urls.localUrlForBrowser);
    });

    ['SIGINT', 'SIGTERM'].forEach(function(sig) {
      process.on(sig, function() {
        devServer.close();
        process.exit();
      });
    });

    if (isInteractive || process.env.CI !== 'true') {
      // Gracefully exit when stdin ends
      process.stdin.on('end', function() {
        devServer.close();
        process.exit();
      });
      process.stdin.resume();
    }
  })
  .catch(err => {
    if (err && err.message) {
      console.log(err.message);
    }
    process.exit(1);
  });
 ```

​	robots.txt文件是一个[文本](https://baike.baidu.com/item/%E6%96%87%E6%9C%AC)文件，使用[任何](https://baike.baidu.com/item/%E4%BB%BB%E4%BD%95)一个常见的[文本编辑](https://baike.baidu.com/item/%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91)器，比如[Windows](https://baike.baidu.com/item/Windows)系统自带的Notepad，就可以创建和编辑它[1][ ](undefined) 。[robot](https://baike.baidu.com/item/robot)s.txt是一个协议，而不是一个[命令](https://baike.baidu.com/item/%E5%91%BD%E4%BB%A4)。robots.txt是[搜索引擎](https://baike.baidu.com/item/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E)中访问网站的时候要查看的第一个文件。robots.txt文件告诉[蜘蛛程序](https://baike.baidu.com/item/%E8%9C%98%E8%9B%9B%E7%A8%8B%E5%BA%8F)在服务器上什么文件是可以被查看的。

```
 		return (
-			// <div className={['table-normal', 'table-' + type, className].join(' ')}>
-				<div className={[className, "table-body"].join(' ')}>
-					{this.props.children}
-				</div>
-			// </div>
 		)
```

Error: .plugins[1][2] must be a string, or undefined
​    at Array.forEach (<anonymous>)
​    at Array.forEach (<anonymous>)



# babel-present-env 与 babel-polyfill 学习总结

https://segmentfault.com/a/1190000015482789?utm_source=sf-related 



# 理解webpack4.splitChunks

https://www.cnblogs.com/kwzm/p/10314438.html

# [详解CommonsChunkPlugin的配置和用法](https://segmentfault.com/a/1190000012828879)

https://segmentfault.com/a/1190000012828879?utm_source=tag-newest



https://www.webpackjs.com/plugins/split-chunks-plugin/

https://webpack.js.org/plugins/split-chunks-plugin/



6、允许装饰器 https://github.com/lin-123/javascript#types

```
yarn add @babel/plugin-proposal-decorators


"babel": {
    "plugins": [
      ["@babel/plugin-proposal-decorators", { "legacy": true }]
    ],
    "presets": [
      "react-app"
    ]
  }
```
"react/jsx-filename-extension": [1, { extensions: [".js"] }], // 允许js文件使用jsx语法

"react/prop-types": 1, // 开启PropTypes验证

"react/forbid-prop-types": 0,

"react/prefer-stateless-function": 1, // 建议使用函数式组件

"linebreak-style": 0,

"react/jsx-one-expression-per-line": 0,

"react-hooks/rules-of-hooks": "error", // 检查 Hook 的规则

"react-hooks/exhaustive-deps": "warn", // 检查 effect 的依赖

'import/no-unresolved': [1, { ignore: ['^@/'] }],



https://github.com/lin-123/javascript#types airbnb Javascript的eslint配置



https://www.jianshu.com/p/93d76c82cfd1  深究create-react-app初始化项目巨慢的问题



https://segmentfault.com/a/1190000021689852?utm_source=weekly&utm_medium=email&utm_campaign=email_weekly



```
pointer-events:  auto | none | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | inherit
```

pointer-events属性有很多值，但是对于浏览器来说，只有auto和non两个值可用，其它的几个是针对SVG的(本身这个属性就来自于SVG技术)。

@郑州网建

### pointer-events属性值详解

- auto——效果和没有定义pointer-events属性相同，鼠标不会穿透当前层。在SVG中，该值和visiblePainted的效果相同。
- none——元素不再是鼠标事件的目标，鼠标不再监听当前层而去监听下面的层中的元素。但是如果它的子元素设置了pointer-events为其它值，比如auto，鼠标还是会监听这个子元素的。

[https://blog.csdn.net/qq_29606781/article/details/67650869](https://blog.csdn.net/qq_29606781/article/details/67650869)

# js添加事件和移除事件:addEventListener()与removeEventListener()



Error: Plugin/Preset files are not allowed to export objects, only functions



[https://blog.csdn.net/weixin_42235173/article/details/90897014](https://blog.csdn.net/weixin_42235173/article/details/90897014)



[https://blog.csdn.net/qq_38242751/article/details/102469219](https://blog.csdn.net/qq_38242751/article/details/102469219)



export const ENTER_TRANSFERRED = '\r\n'



[https://zhuanlan.zhihu.com/p/93269892](https://zhuanlan.zhihu.com/p/93269892)



#### vue-cli 3 和 create-react-app 都支持向前端环境添加变量，我们从命令入手，在package.json添加如下命令：

- VUE

```
"scripts": {
    "dev": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "build:dev": "vue-cli-service build  --mode dev",
    "build:devtest": "vue-cli-service build  --mode devtest",
    "build:test": "vue-cli-service build --mode test",
    "build:release": "vue-cli-service build --mode release"
  }
```

- REACT

```
"scripts": {
    "dev": "react-scripts start",
    "build": "react-scripts build",
    "build:dev": "env-cmd -f .env.dev npm run build",
    "build:devtest": "env-cmd -f .env.devtest npm run build",
    "build:test": "env-cmd -f .env.test npm run build",
    "build:release": "env-cmd -f .env.release npm run build",
  }
```

#### 对应的在根目录添加 .env.dev 、 .env.devtest 、 .env.release 、 .env.test 在文件里面写入对应的变量。

- VUE

```
NODE_ENV = 'production'
VUE_APP_MODE = 'buildDev'
```

```
NODE_ENV = 'production'
VUE_APP_MODE = 'buildDevTest'
```

```
NODE_ENV = 'production'
VUE_APP_MODE = 'release'
```

```
NODE_ENV = 'production'
VUE_APP_MODE = 'buildTest'
```

- REACT

```
REACT_APP_MODE = 'buildDev'
REACT_APP_MODE = 'buildDevTest'
REACT_APP_MODE = 'release'
REACT_APP_MODE = 'buildTest'
```

> REACT 需要安装 env-cmd

当我们使用不同的打包命令打包文件的时候，相应的变量名就可以在js环境拿到。

```
process.env.NODE_ENV
process.env.VUE_APP_MODE
process.env.REACT_APP_MODE;
```







[https://www.bit-101.com/blog/2020/09/git-based-wiki/](https://www.bit-101.com/blog/2020/09/git-based-wiki/)



性能优化的点

PureComponent 

这个类的用法很简单，如果你有些组件是纯组件，那么把继承类从 Component 换成 PureComponent 即可。当组件更新时，如果组件的 props 和 state 都没发生改变，render 方法就不会触发，省去 Virtual DOM 的生成和比对过程，达到提升性能的目的。

内进行的仅仅是浅比较对象

 

# PureComponent遇上ImmutableJS

# [https://blog.csdn.net/sinat_17775997/article/details/77979605](https://blog.csdn.net/sinat_17775997/article/details/77979605)



# 单元测试

[https://www.zhihu.com/question/292847438/answer/866194734](https://www.zhihu.com/question/292847438/answer/866194734)

[https://zhuanlan.zhihu.com/p/55960017](https://zhuanlan.zhihu.com/p/55960017)



iOS WKWebView的使 用 [https://www.jianshu.com/p/5cf0d241ae12](https://www.jianshu.com/p/5cf0d241ae12)

[https://webkit.org/blog/7929/designing-websites-for-iphone-x/](https://webkit.org/blog/7929/designing-websites-for-iphone-x/)



# 性能优化

一、避免不必要的重新渲染，有两种方式： 第一种是 react-immutable-render-mixin：

```
import React from 'react'
import { immutableRenderDecorator }	from 'react-immutable-render-mixin'

@immutableRenderDecorator
export default
class Title extends React.Component {
  ...
}
```

​	第二种是 PureComponent：

```
import React from 'react'

export default
class Title extends React.PureComponent {
  ...
}
```

​	我认为二选其一就可以，没有必要用两种，论简洁推荐使用 PureComponent，两种都要确保引用类型为immutable。有个情况要注意，传入子组件的属性方法一定不能是箭头函数，因为每次父组件的重新渲染都是重新生成的箭头函数。

二、